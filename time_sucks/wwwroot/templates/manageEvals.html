<div id="manageEvals" ng-cloak>
    <h3 class="mt-3">Manage Evaluations</h3>

    <div class="row">
        <div class="input-group col-12 col-md-6 mt-2" ng-if="$parent.user.type === 'A'">
            <div class="input-group-prepend">
                <label class="input-group-text" for="instructor">Instructor</label>
            </div>
            <select class="custom-select" id="instructor" ng-model="userID" ng-change="loadTemplates()">
                <option ng-repeat="i in instructors | orderObjectBy : 'firstName' | filter: {isActive: true}" value="{{i.userID}}" selected>{{i.firstName}} {{i.lastName}}</option>
            </select>
        </div>
        <div class="input-group col-12 col-md-6 mt-2">
            <div class="input-group-prepend">
                <label class="input-group-text" for="template">Template</label>
            </div>
            <select class="custom-select" id="template" ng-model="config.currentTemplate"
                    ng-options="t.evalTemplateID as t.templateName for t in evaluations">
            </select>
        </div>
    </div>

    <div class="row">
        <div class="input-group col-12 col-md-6 mt-2">
            <div class="input-group-prepend">
                <label class="input-group-text" for="templateName">Template Name</label>
            </div>
            <input type="text" class="form-control" id="templateName" ng-model="evaluations[config.currentTemplate].templateName"
                    ng-disabled="evaluations[config.currentTemplate].inUse"/>
        </div>
        <div class="col-12 col-md-6 mt-2 text-center" ng-if="evaluations[config.currentTemplate].inUse">
            <h4 class="text-danger">In Use - Cannot Be Edited</h4>
        </div>
    </div>


    <div class="mt-4 table-responsive">

        <table class="table table-condensed">
            <thead class="thead-light">
                <tr>
                    <th style="width: 225px; min-width: 150px;">Category/Question</th>
                    <th style="min-width: 150px;">Options
                        <button class="btn btn-primary float-right" ng-click="addQuestion(0)" ng-disabled="evaluations[config.currentTemplate].inUse">New Question</button>
                        <button class="btn btn-primary float-right mr-2" ng-click="addCategory" ng-disabled="evaluations[config.currentTemplate].inUse">New Category</button>
                    </th>
                </tr>
            </thead>
            <tbody id="noCategoryQuestions">
                <tr ng-repeat="tq in evaluations[config.currentTemplate].templateQuestions | orderObjectBy : 'number' | filter: {evalTemplateQuestionCategoryID: 0}">
                    <td class="border-right"><textarea class="h-100 w-100" placeholder="Question Text" ng-model="tq.questionText" ng-disabled="evaluations[config.currentTemplate].inUse"></textarea></td>
                    <td class="p-1 align-middle border-right">
                        <select ng-model="tq.questionType" title="Question Type" ng-disabled="evaluations[config.currentTemplate].inUse">
                            <option value="N">Number 0-5</option>
                            <option value="R">Short Reponse</option>
                        </select>
                        <input type="number" style="height: 22px; width: 50px;" ng-model="tq.number" title="Order Number" ng-disabled="evaluations[config.currentTemplate].inUse"/>
                        <select ng-model="tq.evalTemplateQuestionCategoryID" title="Category" ng-disabled="evaluations[config.currentTemplate].inUse"
                                ng-options="c.evalTemplateQuestionCategoryID as c.categoryName for c in evaluations[config.currentTemplate].categories">
                            <option value="0">No Category</option>
                        </select>
                    </td>
                </tr>
            </tbody>
            <tbody ng-repeat="c in evaluations[config.currentTemplate].categories">
                <tr style="background-color: ghostwhite;">
                    <th class="border-right"><input class="font-weight-bold" type="text" ng-model="c.categoryName" ng-disabled="evaluations[config.currentTemplate].inUse"/></th>
                    <td><button class="btn btn-primary float-right" ng-click="addQuestion(c.categoryID)" ng-disabled="evaluations[config.currentTemplate].inUse">New Question</button></td>
                </tr>
                <tr ng-repeat="tq in evaluations[config.currentTemplate].templateQuestions | orderObjectBy : 'number' | filter: {evalTemplateQuestionCategoryID: c.evalTemplateQuestionCategoryID}">
                    <td class="border-right"><textarea class="h-100 w-100" placeholder="Question Text" ng-model="tq.questionText" ng-disabled="evaluations[config.currentTemplate].inUse"></textarea></td>
                    <td class="p-1 align-middle border-right">
                        <select ng-model="tq.questionType" title="Question Type" ng-disabled="evaluations[config.currentTemplate].inUse">
                            <option value="N">Number 0-5</option>
                            <option value="R">Short Reponse</option>
                        </select>
                        <input type="number" style="height: 22px; width: 50px;" ng-model="tq.number" title="Order Number" ng-disabled="evaluations[config.currentTemplate].inUse"/>
                        <select ng-model="tq.evalTemplateQuestionCategoryID" title="Category" ng-disabled="evaluations[config.currentTemplate].inUse"
                                ng-options="c.evalTemplateQuestionCategoryID as c.categoryName for c in evaluations[config.currentTemplate].categories">
                            <option value="0">No Category</option>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="w-100 mt-2">
        <button class="btn btn-primary float-right mb-3" ng-click="saveCurrentTemplate()" ng-disabled="evaluations[currentTemplate].inUse">Save Template</button>
    </div>
</div>